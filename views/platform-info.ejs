<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platform Information - Digital Threat Assessment Management</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/onboarding.css">
    <script src="/js/onboarding.js"></script>
</head>
<body class="onboarding-body">
    <div class="onboarding-container">
        <div class="onboarding-card">
            <div class="onboarding-header">
                <h1>Digital Threat Assessment Management</h1>
            </div>
            <div class="onboarding-content">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-step completed">1</div>
                        <div class="progress-step completed">2</div>
                        <div class="progress-step completed">3</div>
                        <div class="progress-step completed">4</div>
                        <div class="progress-step active">5</div>
                    </div>
                    <div class="progress-labels">
                        <div class="progress-label completed">Terms</div>
                        <div class="progress-label completed">Case</div>
                        <div class="progress-label completed">SOC</div>
                        <div class="progress-label completed">Safety</div>
                        <div class="progress-label active">Platform</div>
                    </div>
                </div>
                
                <h2>Social Media Platform Information</h2>
                <p id="platformInfoDesc">Please provide information about the social media platforms used by the Subject of Concern (SOC). This will help with your digital threat assessment.</p>
                
                <div class="platform-info-layout">
                    <div class="account-setup-container">
                        <form action="/summary" method="POST" class="onboarding-form" id="platformInfoForm">
                            <input type="hidden" name="platformData" id="platformDataInput" value="{}">
                            
                            <div class="platform-selection">
                        <label>Select the platforms where the SOC has accounts:</label>
                        <div class="platform-grid">
                            <div class="platform-option" data-platform="instagram" onclick="togglePlatform(this)">
                                <div class="platform-icon">üì∏</div>
                                <div class="platform-name">Instagram</div>
                            </div>
                            <div class="platform-option" data-platform="snapchat" onclick="togglePlatform(this)">
                                <div class="platform-icon">üëª</div>
                                <div class="platform-name">Snapchat</div>
                            </div>
                            <div class="platform-option" data-platform="tiktok" onclick="togglePlatform(this)">
                                <div class="platform-icon">üéµ</div>
                                <div class="platform-name">TikTok</div>
                            </div>
                            <div class="platform-option" data-platform="facebook" onclick="togglePlatform(this)">
                                <div class="platform-icon">üëç</div>
                                <div class="platform-name">Facebook</div>
                            </div>
                            <div class="platform-option" data-platform="twitter" onclick="togglePlatform(this)">
                                <div class="platform-icon">üê¶</div>
                                <div class="platform-name">Twitter</div>
                            </div>
                            <div class="platform-option" data-platform="discord" onclick="togglePlatform(this)">
                                <div class="platform-icon">üí¨</div>
                                <div class="platform-name">Discord</div>
                            </div>
                            <div class="platform-option" data-platform="other" onclick="togglePlatform(this)">
                                <div class="platform-icon">‚ûï</div>
                                <div class="platform-name">Other</div>
                            </div>
                        </div>
                            </div>
                            
                            <div id="platformDetails" style="display: none;">
                        <h3 id="platformDetailsTitle">Platform Details</h3>
                        
                        <div class="form-group">
                            <div class="label-with-tooltip">
                                <label for="username">Username</label>
                                <span class="tooltip-icon">
                                    ?
                                    <span class="tooltip-text">The @handle someone uses to identify their account (e.g., @john_doe123). This appears after the @ symbol.</span>
                                </span>
                            </div>
                            <input type="text" id="username" name="username" class="form-control" placeholder="Enter username">
                        </div>
                        
                        <div class="form-group">
                            <div class="label-with-tooltip">
                                <label for="displayName">Display Name</label>
                                <span class="tooltip-icon">
                                    ?
                                    <span class="tooltip-text">The name shown on their profile that others see (e.g., John Doe). This can be their real name or any chosen name.</span>
                                </span>
                            </div>
                            <input type="text" id="displayName" name="displayName" class="form-control" placeholder="Enter display name">
                        </div>
                        
                        <div class="form-group">
                            <label for="profileUrl">URL</label>
                            <input type="text" id="profileUrl" name="profileUrl" class="form-control" placeholder="Enter profile URL">
                        </div>
                        
                        <div class="form-group">
                            <button type="button" class="btn btn-secondary" id="addPlatformBtn">Add Platform</button>
                        </div>
                            </div>
                            
                            <div id="selectedPlatforms" style="display: none;">
                                <h3>Selected Platforms</h3>
                                <div id="platformList" class="platform-list"></div>
                            </div>
                            
                            <div id="unknownThreatSection" style="display: none;">
                        <h3>Unknown Threat Information</h3>
                        <p>Since the threat maker is unknown, please provide information about how the threat was discovered.</p>
                        
                        <div class="radio-group">
                            <div class="radio-option" data-value="physical" onclick="selectThreatSource(this)">
                                <input type="radio" id="physical" name="threatSource" value="physical">
                                <label for="physical" class="option-label">The threat was left via bathroom wall graffiti, note, etc.</label>
                            </div>
                            <div class="radio-option" data-value="social" onclick="selectThreatSource(this)">
                                <input type="radio" id="social" name="threatSource" value="social">
                                <label for="social" class="option-label">The threat is an anonymous social media post</label>
                            </div>
                        </div>
                        
                        <div id="socialMediaSource" style="display: none;">
                            <div class="form-group">
                                <label for="sourcePlatform">Which platform was the threat posted on?</label>
                                <select id="sourcePlatform" name="sourcePlatform" class="form-control">
                                    <option value="">Select a platform</option>
                                    <option value="instagram">Instagram</option>
                                    <option value="snapchat">Snapchat</option>
                                    <option value="tiktok">TikTok</option>
                                    <option value="facebook">Facebook</option>
                                    <option value="twitter">Twitter</option>
                                    <option value="discord">Discord</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                            </div>
                            
                            <div class="nav-buttons">
                                <a href="/safety-assessment" class="btn btn-secondary btn-back">Back</a>
                                <button type="submit" class="btn btn-primary" id="continueBtn">Continue to Workstation</button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="search-tools">
                        <h3 class="search-tools-title">üîç Need help finding this info?</h3>
                        <div class="search-buttons">
                            <button type="button" class="search-btn" id="whatsmynameBtn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                                </svg>
                                Search WhatsMyName
                            </button>
                            <button type="button" class="search-btn" id="googleBtn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                                </svg>
                                Search Google
                            </button>
                            <button type="button" class="search-btn" id="searchTipsBtn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
                                </svg>
                                Manual Search Tips
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* Two-column layout for platform info */
        .platform-info-layout {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .account-setup-container {
            flex: 2;
        }
        
        .search-tools {
            flex: 1;
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            height: fit-content;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .search-tools-title {
            font-size: 16px;
            margin-bottom: 15px;
            color: #555;
        }
        
        .search-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .search-btn {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .search-btn:hover {
            background-color: #e8f5ff;
            border-color: #0095f6;
        }
        
        .search-btn .icon {
            width: 16px;
            height: 16px;
            margin-right: 8px;
        }
        
        /* Responsive layout */
        @media (max-width: 768px) {
            .platform-info-layout {
                flex-direction: column;
            }
            
            .account-setup-container, .search-tools {
                width: 100%;
            }
        }
        
        .label-with-tooltip {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }
        
        .tooltip-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background-color: #e0e0e0;
            color: #555;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
            cursor: help;
            transition: background-color 0.2s;
        }
        
        .tooltip-icon:hover {
            background-color: #0095f6;
            color: white;
        }
        
        .tooltip-icon .tooltip-text {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1000;
            /* Position to the right instead of above */
            top: -5px;
            left: 30px;
            opacity: 0;
            transition: opacity 0.3s;
            font-weight: normal;
            font-size: 13px;
            line-height: 1.4;
            white-space: normal;
            word-wrap: break-word;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        /* Add a triangle pointer to the left side of the tooltip */
        .tooltip-icon .tooltip-text::before {
            content: "";
            position: absolute;
            top: 10px;
            left: -10px;
            border-width: 5px;
            border-style: solid;
            border-color: transparent #333 transparent transparent;
        }
        
        /* Media query for smaller screens */
        @media (max-width: 768px) {
            .tooltip-icon .tooltip-text {
                width: 200px;
            }
        }
        
        .tooltip-icon:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        .tooltip-icon {
            position: relative;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow: auto;
        }
        
        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 2rem;
            border-radius: 8px;
            max-width: 600px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            position: relative;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
        }
        
        .modal-title {
            margin: 0;
            font-size: 1.5rem;
            color: #333;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
            transition: color 0.2s;
        }
        
        .close-btn:hover {
            color: #333;
        }
        
        .modal-body {
            margin-bottom: 1rem;
        }
        
        .search-tip {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .search-tip:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .search-tip-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #0066cc;
        }
    </style>
    
    <script>
        // Get SOC status from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const socStatus = urlParams.get('socStatus') || 'known';
        
        // Initialize platform data
        let platformData = {
            platforms: {},
            threatSource: null,
            sourcePlatform: null
        };
        
        // Current platform being edited
        let currentPlatform = null;
        
        // Initialize page based on SOC status
        document.addEventListener('DOMContentLoaded', function() {
            if (socStatus === 'unknown') {
                document.getElementById('platformInfoDesc').textContent = 'Since the threat maker is unknown, please provide information about how the threat was discovered.';
                document.getElementById('unknownThreatSection').style.display = 'block';
                document.querySelector('.platform-selection').style.display = 'none';
            }
        });
        
        // Toggle platform selection
        function togglePlatform(element) {
            // If already selected, deselect
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                currentPlatform = null;
                document.getElementById('platformDetails').style.display = 'none';
                return;
            }
            
            // Deselect all platforms
            document.querySelectorAll('.platform-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Select this platform
            element.classList.add('selected');
            currentPlatform = element.dataset.platform;
            
            // Show platform details
            document.getElementById('platformDetails').style.display = 'block';
            document.getElementById('platformDetailsTitle').textContent = element.querySelector('.platform-name').textContent + ' Details';
            
            // Clear form fields
            document.getElementById('username').value = '';
            document.getElementById('displayName').value = '';
            document.getElementById('profileUrl').value = '';
        }
        
        // Add platform to selected platforms
        document.getElementById('addPlatformBtn').addEventListener('click', function() {
            if (!currentPlatform) return;
            
            const username = document.getElementById('username').value.trim();
            const displayName = document.getElementById('displayName').value.trim();
            const profileUrl = document.getElementById('profileUrl').value.trim();
            
            if (!username) {
                alert('Please enter a username');
                return;
            }
            
            // Add to platform data
            platformData.platforms[currentPlatform] = {
                username,
                displayName,
                profileUrl
            };
            
            // Update hidden input
            document.getElementById('platformDataInput').value = JSON.stringify(platformData);
            
            // Update UI
            updatePlatformList();
            
            // Reset form
            document.querySelectorAll('.platform-option').forEach(option => {
                option.classList.remove('selected');
            });
            currentPlatform = null;
            document.getElementById('platformDetails').style.display = 'none';
        });
        
        // Update platform list UI
        function updatePlatformList() {
            const platformList = document.getElementById('platformList');
            platformList.innerHTML = '';
            
            const platforms = Object.keys(platformData.platforms);
            
            if (platforms.length === 0) {
                document.getElementById('selectedPlatforms').style.display = 'none';
                return;
            }
            
            document.getElementById('selectedPlatforms').style.display = 'block';
            
            platforms.forEach(platform => {
                const data = platformData.platforms[platform];
                
                const platformItem = document.createElement('div');
                platformItem.className = 'platform-item';
                platformItem.innerHTML = `
                    <div class="platform-item-header">
                        <strong>${platform.charAt(0).toUpperCase() + platform.slice(1)}</strong>
                        <button type="button" class="btn-remove" data-platform="${platform}">√ó</button>
                    </div>
                    <div class="platform-item-details">
                        <div><strong>Username:</strong> ${data.username}</div>
                        <div><strong>Display Name:</strong> ${data.displayName || 'N/A'}</div>
                        <div><strong>URL:</strong> ${data.profileUrl || 'N/A'}</div>
                    </div>
                `;
                
                platformList.appendChild(platformItem);
            });
            
            // Add event listeners to remove buttons
            document.querySelectorAll('.btn-remove').forEach(btn => {
                btn.addEventListener('click', function() {
                    const platform = this.dataset.platform;
                    delete platformData.platforms[platform];
                    document.getElementById('platformDataInput').value = JSON.stringify(platformData);
                    updatePlatformList();
                });
            });
        }
        
        // Select threat source for unknown SOC
        function selectThreatSource(element) {
            // Remove selected class from all options
            document.querySelectorAll('.radio-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selected class to clicked option
            element.classList.add('selected');
            
            // Update threat source
            const value = element.dataset.value;
            platformData.threatSource = value;
            
            // Show/hide social media source
            document.getElementById('socialMediaSource').style.display = value === 'social' ? 'block' : 'none';
            
            // Update hidden input
            document.getElementById('platformDataInput').value = JSON.stringify(platformData);
        }
        
        // Update source platform
        document.getElementById('sourcePlatform').addEventListener('change', function() {
            platformData.sourcePlatform = this.value;
            document.getElementById('platformDataInput').value = JSON.stringify(platformData);
        });
        
        // Search tools functionality
        document.addEventListener('DOMContentLoaded', function() {
            // WhatsMyName search
            document.getElementById('whatsmynameBtn').addEventListener('click', function() {
                const username = document.getElementById('username').value.trim();
                if (username) {
                    window.open(`https://whatsmyname.app/?q=${encodeURIComponent(username)}`, '_blank');
                } else {
                    alert('Please enter a username to search');
                }
            });
            
            // Google search
            document.getElementById('googleBtn').addEventListener('click', function() {
                const username = document.getElementById('username').value.trim();
                const platform = currentPlatform || '';
                
                if (username) {
                    window.open(`https://www.google.com/search?q=${encodeURIComponent(username + ' ' + platform)}`, '_blank');
                } else {
                    alert('Please enter a username to search');
                }
            });
            
            // Search tips modal
            const searchTipsBtn = document.getElementById('searchTipsBtn');
            
            searchTipsBtn.addEventListener('click', function() {
                // Create modal if it doesn't exist
                if (!document.getElementById('searchTipsModal')) {
                    const modal = document.createElement('div');
                    modal.id = 'searchTipsModal';
                    modal.className = 'modal';
                    modal.innerHTML = `
                        <div class="modal-content">
                            <div class="modal-header">
                                <h2 class="modal-title">Manual Search Tips</h2>
                                <button class="close-btn" id="closeSearchTipsBtn">√ó</button>
                            </div>
                            <div class="modal-body">
                                <div class="search-tip">
                                    <div class="search-tip-title">1. Try variations of the person's name</div>
                                    <p>Search for different combinations of first name, last name, initials, and common username patterns (firstname.lastname, firstinitial_lastname, etc.)</p>
                                </div>
                                <div class="search-tip">
                                    <div class="search-tip-title">2. Use advanced search operators</div>
                                    <p>On Google, try using quotes for exact matches: "John Smith Instagram" or site-specific searches: site:instagram.com "John Smith"</p>
                                </div>
                                <div class="search-tip">
                                    <div class="search-tip-title">3. Check connected accounts</div>
                                    <p>If you find one social media account, look for links to other platforms in their bio or posts</p>
                                </div>
                                <div class="search-tip">
                                    <div class="search-tip-title">4. Look for unique identifiers</div>
                                    <p>Search for email addresses, usernames from other platforms, or unique phrases/interests mentioned in known profiles</p>
                                </div>
                                <div class="search-tip">
                                    <div class="search-tip-title">5. Use reverse image search</div>
                                    <p>If you have a photo of the person, try using Google Images or TinEye to find where else that image appears online</p>
                                </div>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(modal);
                    
                    // Add close button functionality
                    document.getElementById('closeSearchTipsBtn').addEventListener('click', function() {
                        document.getElementById('searchTipsModal').style.display = 'none';
                    });
                    
                    // Close modal when clicking outside
                    window.addEventListener('click', function(event) {
                        const modal = document.getElementById('searchTipsModal');
                        if (event.target === modal) {
                            modal.style.display = 'none';
                        }
                    });
                }
                
                // Show modal
                document.getElementById('searchTipsModal').style.display = 'block';
            });
        });
    </script>
</body>
</html>
