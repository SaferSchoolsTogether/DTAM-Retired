<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= platform.charAt(0).toUpperCase() + platform.slice(1) %> Workstation</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/onboarding.css">
    <style>
        /* Profile field styles */
        .user-info {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 16px;
        }
        
        .profile-field {
            display: flex;
            flex-direction: column;
            min-width: 180px;
        }
        
        .profile-input {
            padding: 8px 12px;
            border: 1px solid #dbdbdb;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        .profile-input:focus {
            outline: none;
            border-color: #0095f6;
        }
        
        /* Tooltip styles */
        .label-with-tooltip {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }
        
        .tooltip-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background-color: #e0e0e0;
            color: #555;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
            cursor: help;
            transition: background-color 0.2s;
            position: relative;
        }
        
        .tooltip-icon:hover {
            background-color: #0095f6;
            color: white;
        }
        
        .tooltip-icon .tooltip-text {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 1000;
            top: 125%; /* Changed from bottom: 125% to top: 125% */
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-weight: normal;
            font-size: 13px;
            line-height: 1.4;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .tooltip-icon .tooltip-text::after {
            content: "";
            position: absolute;
            bottom: 100%; /* Changed from top: 100% to bottom: 100% */
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: transparent transparent #333 transparent; /* Changed arrow direction */
        }
        
        .tooltip-icon:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body data-soc-id="<%= socId %>">
    <%- include('partials/navigation', { activePage: 'workstation' }) %>
    
    <!-- Header -->
    <header class="header">
        <div class="logo-section">
            <div class="sst-logo">SST</div>
            <h1 class="platform-title"><%= platform.charAt(0).toUpperCase() + platform.slice(1) %> Workstation</h1>
            <div class="progress-indicator" id="progressIndicator">
                <% if (platformData.photos.length > 0) { %>
                    Photo 1 of <%= platformData.photos.length %>
                <% } else { %>
                    No photos
                <% } %>
            </div>
            <div class="soc-selector-container">
                <label for="socSelector">SOC:</label>
                <select id="socSelector" class="soc-selector">
                    <% allSocs.forEach(function(s) { %>
                        <option value="<%= s %>" <%= s === socId ? 'selected' : '' %> <%= s === activeSocId ? 'class="active-soc"' : '' %>>
                            <%= allSocsData[s].name || 'Unnamed SOC' %>
                            <%= s === activeSocId ? '(Active)' : '' %>
                        </option>
                    <% }); %>
                    <option value="add_new" class="add-new-option">+ Add New SOC</option>
                </select>
            </div>
        </div>
        <div class="user-info">
            <div class="profile-field">
                <div class="label-with-tooltip">
                    <label for="username">Username</label>
                    <span class="tooltip-icon">
                        ?
                        <span class="tooltip-text">The @handle someone uses to identify their account (e.g., @john_doe123). This appears after the @ symbol.</span>
                    </span>
                </div>
                <input type="text" id="username" class="profile-input" value="<%= platformData.username %>" placeholder="Enter username">
            </div>
            <div class="profile-field">
                <div class="label-with-tooltip">
                    <label for="displayName">Display Name</label>
                    <span class="tooltip-icon">
                        ?
                        <span class="tooltip-text">The name shown on their profile that others see (e.g., John Doe). This can be their real name or any chosen name.</span>
                    </span>
                </div>
                <input type="text" id="displayName" class="profile-input" value="<%= platformData.displayName %>" placeholder="Enter display name">
            </div>
            <div class="profile-field">
                <label for="profileUrl">URL</label>
                <input type="text" id="profileUrl" class="profile-input" value="<%= platformData.url %>" placeholder="Enter profile URL">
            </div>
            <button id="clearSessionBtn" class="btn btn-danger">Clear Session</button>
        </div>
</header>

    <%- include('partials/case-context-bar') %>
    
    <%- include('partials/help-panel') %>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Platform Sidebar -->
        <div class="sidebar">
            <% allPlatforms.forEach(function(p) { %>
                <a href="/soc/<%= socId %>/platform/<%= p %>" class="platform-icon <%= p === platform ? 'active' : '' %>">
                    <span><%= p.substring(0, 2).toUpperCase() %></span>
                    <% if (p === platform && platformData.photos.length > 0) { %>
                        <span class="platform-progress"><%= platformData.photos.filter(photo => Object.keys(photo.analysisTags).length > 0).length %>/<%= platformData.photos.length %></span>
                    <% } %>
                </a>
            <% }); %>
        </div>

        <%- include('partials/photo-grid') %>

        <!-- Main Workspace -->
        <div class="workspace">
            <div class="workspace-content">
                <% if (platformData.photos.length > 0) { %>
                    <!-- Image Viewer -->
                    <div class="image-viewer">
                        <img src="<%= platformData.photos[0].path %>" alt="Current photo" class="current-image" id="currentImage">
                        
                        <div class="image-tools">
                            <button class="tool-btn" id="zoomBtn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                                </svg>
                                Zoom
                            </button>
                            <button class="tool-btn" id="annotateBtn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                </svg>
                                Annotate
                            </button>
                            <button class="tool-btn" id="analyticsBtn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                                </svg>
                                Analytics
                            </button>
                        </div>
                    </div>

                    <!-- Analysis Panel -->
                    <div class="analysis-panel">
                        <!-- Analyze Button -->
                        <button class="analyze-btn" id="analyzeBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
                            </svg>
                            Analyze Photo
                        </button>

                        <div class="panel-section">
                            <h3 class="section-title">Tags</h3>
                            <div class="tags-container" id="tagsContainer">
                                <% if (platformData.photos.length > 0 && platformData.photos[0].tags.length > 0) { %>
                                    <% platformData.photos[0].tags.forEach(function(tag) { %>
                                        <span class="tag">
                                            <%= tag %>
                                            <span class="tag-remove" data-tag="<%= tag %>">Ã—</span>
                                        </span>
                                    <% }); %>
                                <% } %>
                            </div>
                            <input type="text" class="add-tag-input" id="addTagInput" placeholder="Add a tag...">
                        </div>

                        <div class="panel-section">
                            <h3 class="section-title">Notes</h3>
                            <textarea class="notes-textarea" id="notesTextarea" placeholder="Add your notes about this photo..."><%= platformData.photos.length > 0 ? platformData.photos[0].notes : '' %></textarea>
                        </div>

                        <div class="panel-section">
                            <h3 class="section-title">Image Details</h3>
                            <div class="image-details">
                                <% if (platformData.photos.length > 0) { %>
                                    <div class="detail-row">
                                        <span class="detail-label">Posted:</span>
                                        <span class="detail-value"><%= platformData.photos[0].metadata.posted %></span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Likes:</span>
                                        <span class="detail-value"><%= platformData.photos[0].metadata.likes %></span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Comments:</span>
                                        <span class="detail-value"><%= platformData.photos[0].metadata.comments %></span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Engagement Rate:</span>
                                        <span class="detail-value"><%= platformData.photos[0].metadata.engagementRate %></span>
                                    </div>
                                <% } else { %>
                                    <div class="detail-row">
                                        <span class="detail-label">No photo selected</span>
                                        <span class="detail-value"></span>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                <% } else { %>
                    <!-- Empty State -->
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“·</div>
                        <div class="empty-state-message">No photos yet. Click "Add" to upload photos.</div>
                        <button class="btn btn-primary" id="emptyStateAddBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
                            </svg>
                            Add Photos
                        </button>
                    </div>
                <% } %>
            </div>

            <!-- Action Bar -->
            <div class="action-bar">
                <div class="save-indicator" id="saveIndicator">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                    </svg>
                    All changes saved
                </div>
                <div class="action-group">
                    <button class="btn btn-secondary" id="previewReportBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        Preview Report
                    </button>
                    <button class="btn btn-secondary" id="saveProgressBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                        </svg>
                        Save Progress
                    </button>
                    <button class="btn btn-primary" id="generateReportBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/>
                        </svg>
                        Generate Report
                    </button>
                </div>
            </div>
        </div>
    </div>

    <%- include('partials/upload-modal') %>
    <%- include('partials/analysis-modal') %>

    <!-- Add SOC Modal -->
    <div class="modal" id="addSocModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New SOC</h2>
                <button class="close-btn" id="closeAddSocBtn">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="addSocForm">
                    <div class="form-group">
                        <label for="socName">Name</label>
                        <input type="text" id="socName" class="form-input" placeholder="Enter SOC name" required>
                    </div>
                    <div class="form-group">
                        <label for="socStudentId">Student ID</label>
                        <input type="text" id="socStudentId" class="form-input" placeholder="Enter student ID">
                    </div>
                    <div class="form-group">
                        <label for="socGrade">Grade</label>
                        <input type="text" id="socGrade" class="form-input" placeholder="Enter grade">
                    </div>
                    <div class="form-group">
                        <label for="socSchool">School</label>
                        <input type="text" id="socSchool" class="form-input" placeholder="Enter school">
                    </div>
                    <div class="form-group">
                        <label for="socDob">Date of Birth</label>
                        <input type="date" id="socDob" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="socStatus" value="known" checked>
                                Known
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="socStatus" value="potential">
                                Potential
                            </label>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" id="submitAddSocBtn">Add SOC</button>
                </form>
            </div>
        </div>
    </div>

<script src="/js/navigation.js"></script>
<script src="/js/workstation.js?v=<%= new Date().getTime() %>" type="module"></script>
</body>
</html>
