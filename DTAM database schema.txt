-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.cases (
  id text NOT NULL,
  date text NOT NULL,
  team_member_name text NOT NULL,
  organization text NOT NULL,
  soc_status text,
  discovery_method text,
  safety_assessment text,
  student_info text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT cases_pkey PRIMARY KEY (id),
  CONSTRAINT cases_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.photos (
  id text NOT NULL,
  soc_id text,
  platform text NOT NULL,
  file_path text NOT NULL,
  thumbnail text,
  upload_date text,
  tags text,
  analysis_tags text,
  notes text,
  metadata text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  case_id text,
  created_by uuid,
  CONSTRAINT photos_pkey PRIMARY KEY (id),
  CONSTRAINT photos_case_id_fkey FOREIGN KEY (case_id) REFERENCES public.cases(id),
  CONSTRAINT photos_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.platforms (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  soc_id text,
  platform_name text NOT NULL,
  username text,
  display_name text,
  profile_url text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT platforms_pkey PRIMARY KEY (id),
  CONSTRAINT platforms_soc_id_fkey FOREIGN KEY (soc_id) REFERENCES public.socs(id),
  CONSTRAINT platforms_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.socs (
  id text NOT NULL DEFAULT (gen_random_uuid())::text,
  case_id text,
  name text,
  student_id text,
  grade text,
  school text,
  dob text,
  support_plans text,
  other_plan_text text,
  status text CHECK (status = ANY (ARRAY['known'::text, 'potential'::text])),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT socs_pkey PRIMARY KEY (id),
  CONSTRAINT socs_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id),
  CONSTRAINT socs_case_id_fkey FOREIGN KEY (case_id) REFERENCES public.cases(id)
);
CREATE TABLE public.threat_socs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  threat_id text,
  soc_id text,
  relationship_type text CHECK (relationship_type = ANY (ARRAY['primary_subject'::text, 'mentioned'::text, 'reporter'::text, 'witness'::text])),
  priority_level text CHECK (priority_level = ANY (ARRAY['high'::text, 'medium'::text, 'low'::text])),
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT threat_socs_pkey PRIMARY KEY (id),
  CONSTRAINT threat_socs_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id),
  CONSTRAINT threat_socs_threat_id_fkey FOREIGN KEY (threat_id) REFERENCES public.threats(id),
  CONSTRAINT threat_socs_soc_id_fkey FOREIGN KEY (soc_id) REFERENCES public.socs(id)
);
CREATE TABLE public.threats (
  id text NOT NULL,
  case_id text,
  discovery_method text CHECK (discovery_method = ANY (ARRAY['graffiti'::text, 'social_media'::text])),
  location text,
  content text,
  language_analysis text,
  reverse_image_results text,
  evidence_photos text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT threats_pkey PRIMARY KEY (id),
  CONSTRAINT threats_case_id_fkey FOREIGN KEY (case_id) REFERENCES public.cases(id),
  CONSTRAINT threats_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.user_profiles (
  id uuid NOT NULL,
  email text NOT NULL,
  first_name text NOT NULL,
  last_name text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_profiles_pkey PRIMARY KEY (id),
  CONSTRAINT user_profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id)
);